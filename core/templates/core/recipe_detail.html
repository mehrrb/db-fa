{% extends "core/base.html" %}

{% block title %}{{ recipe.title }} - جزئیات دستور پخت{% endblock %}

{% block extra_css %}
.recipe-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2rem;
}

.recipe-title-section {
    flex: 1;
}

.recipe-meta {
    display: flex;
    flex-wrap: wrap;
    margin: 1rem 0;
    gap: 1.5rem;
}

.recipe-meta-item {
    display: flex;
    align-items: center;
    color: var(--text-muted);
    font-size: 0.9rem;
}

.recipe-meta-item i {
    color: var(--primary);
    margin-left: 0.5rem;
    font-size: 1.1rem;
}

.recipe-image {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: var(--border-radius);
    margin-bottom: 2rem;
    box-shadow: var(--shadow);
}

.recipe-section {
    margin-bottom: 2.5rem;
}

.section-title {
    font-size: 1.5rem;
    color: var(--text-dark);
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--primary-light);
    position: relative;
}

.section-title:after {
    content: '';
    position: absolute;
    width: 80px;
    height: 2px;
    background: var(--primary);
    bottom: -2px;
    right: 0;
}

.ingredients-list {
    list-style: none;
    padding: 0;
}

.ingredient-item {
    padding: 0.75rem 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid rgba(136, 152, 170, 0.1);
}

.ingredient-item:last-child {
    border-bottom: none;
}

.ingredient-name {
    display: flex;
    align-items: center;
}

.ingredient-name i {
    color: var(--primary);
    margin-left: 0.5rem;
}

.ingredient-amount {
    font-weight: 600;
    color: var(--text-dark);
}

.ingredient-cost {
    color: var(--success);
    font-weight: 600;
}

.steps-list {
    counter-reset: step-counter;
    list-style: none;
    padding: 0;
}

.step-item {
    position: relative;
    padding: 1.5rem 3rem 1.5rem 0;
    border-bottom: 1px solid rgba(136, 152, 170, 0.1);
}

.step-item:last-child {
    border-bottom: none;
}

.step-item:before {
    content: counter(step-counter);
    counter-increment: step-counter;
    position: absolute;
    top: 1.5rem;
    right: 0;
    width: 32px;
    height: 32px;
    background: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
}

.cost-summary {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 2rem;
}

.cost-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
}

.cost-label {
    display: flex;
    align-items: center;
}

.cost-label i {
    margin-left: 0.5rem;
    color: var(--primary);
}

.cost-value {
    font-weight: 700;
    font-size: 1.1rem;
}

.total-cost {
    background: var(--gradient-primary);
    color: white;
}

.total-cost .cost-label i {
    color: white;
}

.notes {
    padding: 1.5rem;
    background-color: rgba(103, 114, 229, 0.05);
    border-radius: var(--border-radius);
    border-right: 3px solid var(--primary);
    margin-bottom: 1.5rem;
}

@media (max-width: 768px) {
    .recipe-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .recipe-meta {
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }
    
    .recipe-actions {
        margin-top: 1rem;
        width: 100%;
    }
    
    .recipe-actions .btn {
        width: 100%;
        margin-bottom: 0.5rem;
    }
}
{% endblock %}

{% block content %}
<div class="header-with-actions">
    <h1>{{ recipe.title }}</h1>
    <div>
        <a href="{% url 'recipe_list' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-right"></i>
            بازگشت به لیست دستور پخت‌ها
        </a>
        <a href="{% url 'recipe_edit' recipe.id %}" class="btn btn-info">
            <i class="fas fa-edit"></i>
            ویرایش
        </a>
        <a href="{% url 'recipe_delete' recipe.id %}" class="btn btn-danger">
            <i class="fas fa-trash"></i>
            حذف
        </a>
    </div>
</div>

{% if recipe.image %}
<img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="recipe-image">
{% endif %}

<div class="recipe-meta">
    <div class="recipe-meta-item">
        <i class="fas fa-clock"></i>
        <span>زمان آماده‌سازی: {{ recipe.preparation_time }} دقیقه</span>
    </div>
    <div class="recipe-meta-item">
        <i class="fas fa-utensils"></i>
        <span>زمان پخت: {{ recipe.cooking_time }} دقیقه</span>
    </div>
    <div class="recipe-meta-item">
        <i class="fas fa-user-friends"></i>
        <span>برای {{ recipe.servings }} نفر</span>
    </div>
    <div class="recipe-meta-item">
        <i class="fas fa-calendar-alt"></i>
        <span>تاریخ ایجاد: {{ recipe.created_at|date:"Y/m/d" }}</span>
    </div>
    <div class="recipe-meta-item">
        <i class="fas fa-{% if recipe.is_public %}globe{% else %}lock{% endif %}"></i>
        <span>وضعیت: {% if recipe.is_public %}عمومی{% else %}خصوصی{% endif %}</span>
    </div>
</div>

{% if recipe.description %}
<div class="card recipe-section">
    <h2 class="section-title">توضیحات</h2>
    <p>{{ recipe.description }}</p>
</div>
{% endif %}

<div class="card recipe-section">
    <h2 class="section-title">مواد لازم</h2>
    <ul class="ingredients-list">
        {% for ingredient in recipe.recipeingredient_set.all %}
        <li class="ingredient-item">
            <div class="ingredient-name">
                <i class="fas fa-carrot"></i>
                <span>{{ ingredient.product_type.name }}</span>
            </div>
            <div class="ingredient-amount">
                {{ ingredient.quantity }} 
                {% if ingredient.unit == 'gram' %}
                    گرم
                {% elif ingredient.unit == 'piece' %}
                    عدد
                {% elif ingredient.unit == 'liter' %}
                    لیتر
                {% elif ingredient.unit == 'meter' %}
                    متر
                {% endif %}
            </div>
            <div class="ingredient-cost">
                {{ ingredient.cost|floatformat:0 }} تومان
            </div>
        </li>
        {% empty %}
        <li>هیچ موادی برای این دستور پخت ثبت نشده است.</li>
        {% endfor %}
    </ul>
</div>

<div class="card recipe-section">
    <h2 class="section-title">روش پخت</h2>
    <ol class="steps-list">
        {% for step in recipe.recipestep_set.all %}
        <li class="step-item">
            {{ step.description }}
        </li>
        {% empty %}
        <li>هیچ مرحله‌ای برای این دستور پخت ثبت نشده است.</li>
        {% endfor %}
    </ol>
</div>

{% if recipe.notes %}
<div class="card recipe-section">
    <h2 class="section-title">یادداشت‌ها</h2>
    <div class="notes">
        {{ recipe.notes }}
    </div>
</div>
{% endif %}

<div class="card recipe-section">
    <h2 class="section-title">جمع بندی هزینه‌ها</h2>
    <div class="cost-summary">
        <div class="cost-item">
            <div class="cost-label">
                <i class="fas fa-shopping-basket"></i>
                <span>هزینه مواد اولیه:</span>
            </div>
            <div class="cost-value">{{ recipe.ingredients_cost|floatformat:0 }} تومان</div>
        </div>
        
        {% if recipe.other_costs %}
        <div class="cost-item">
            <div class="cost-label">
                <i class="fas fa-tools"></i>
                <span>سایر هزینه‌ها:</span>
            </div>
            <div class="cost-value">{{ recipe.other_costs|floatformat:0 }} تومان</div>
        </div>
        {% endif %}
        
        <div class="cost-item total-cost">
            <div class="cost-label">
                <i class="fas fa-calculator"></i>
                <span>هزینه کل:</span>
            </div>
            <div class="cost-value">{{ recipe.total_cost|floatformat:0 }} تومان</div>
        </div>
        
        {% if recipe.selling_price %}
        <div class="cost-item" style="background: var(--gradient-success); color: white;">
            <div class="cost-label">
                <i class="fas fa-tag" style="color: white;"></i>
                <span>قیمت فروش:</span>
            </div>
            <div class="cost-value">{{ recipe.selling_price|floatformat:0 }} تومان</div>
        </div>
        
        <div class="cost-item" style="background: {% if recipe.profit > 0 %}var(--gradient-success){% else %}var(--gradient-danger){% endif %}; color: white;">
            <div class="cost-label">
                <i class="fas fa-chart-line" style="color: white;"></i>
                <span>سود:</span>
            </div>
            <div class="cost-value">{{ recipe.profit|floatformat:0 }} تومان</div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %} 